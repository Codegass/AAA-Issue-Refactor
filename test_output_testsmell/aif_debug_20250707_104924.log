2025-07-07 10:49:24,928 - INFO - logger - ✓ Debug mode enabled. Detailed logs will be saved to: /Users/chenhaowei/Documents/github/AAA-Issue-Refactor/test_output_testsmell/aif_debug_20250707_104924.log
2025-07-07 10:49:24,928 - INFO - cli - AAA Issue Refactor Tool
2025-07-07 10:49:24,929 - INFO - cli - ==================================================
2025-07-07 10:49:24,947 - INFO - utils - Checking GitHub updates... (from https://github.com/Codegass/AAA-Issue-Refactor.git)
2025-07-07 10:49:25,202 - INFO - utils - ✓ Current version is up to date
2025-07-07 10:49:25,202 - INFO - cli - Java Project: /Users/chenhaowei/Documents/github/commons-cli
2025-07-07 10:49:25,202 - INFO - cli - Data Folder: /Users/chenhaowei/Documents/github/AAA-Issue-Refactor/example_data_for_testing/AAA-commons-cli
2025-07-07 10:49:25,202 - INFO - cli - Output Folder: /Users/chenhaowei/Documents/github/AAA-Issue-Refactor/test_output_testsmell
2025-07-07 10:49:25,202 - INFO - cli - 
Mode: Refactor Only (TESTSMELL strategy)
2025-07-07 10:49:25,202 - INFO - cli - Using specified input file: example_data_for_testing/AAA-commons-cli/commons-cli AAAResults.csv
2025-07-07 10:49:25,211 - INFO - cli - 
Phase 2: Test Refactoring (TESTSMELL strategy)
2025-07-07 10:49:25,211 - INFO - cli - ==================================================
2025-07-07 10:49:25,350 - DEBUG - import_manager - Detected JUnit 5, Hamcrest 2.x
2025-07-07 10:49:25,350 - INFO - refactor - Loading test smell data for testsmell strategy...
2025-07-07 10:49:25,352 - INFO - refactor - Loading test smell data from: /Users/chenhaowei/Documents/github/AAA-Issue-Refactor/example_data_for_testing/AAA-commons-cli/commons-cli-detailed-smells.csv
2025-07-07 10:49:25,376 - INFO - refactor - Loaded 676 test smell records from commons-cli-detailed-smells.csv
2025-07-07 10:49:25,377 - INFO - refactor - Total test cases with smell data: 273
2025-07-07 10:49:25,377 - INFO - cli - Processing 1 test cases (test smell detection will be performed)...
2025-07-07 10:49:25,377 - INFO - cli - 
[1/1] Processing: org.apache.commons.cli.bug.BugsTest.test15046
2025-07-07 10:49:25,377 - INFO - cli - Test Smell Types: Eager Test
2025-07-07 10:49:25,378 - INFO - cli -   Refactoring...
2025-07-07 10:49:25,379 - DEBUG - refactor - Refinement loop 1/5, Sanitizer attempt 1/3
2025-07-07 10:50:05,032 - DEBUG - refactor - 
--- Sanitized Code (Loop 1) ---
private CommandLineParser parser;
private Options options;
private String[] cliArgs;

private void setupTest15046() {
    parser = new PosixParser();
    cliArgs = new String[] {"-z", "c"};
    options = new Options();
    options.addOption(new Option("z", "timezone", true, "affected option"));
}

@Test
public void test15046_TimezoneOption() throws Exception {
    setupTest15046();
    CommandLine line = parser.parse(options, cliArgs);
    assertEquals("c", line.getOptionValue('z'), "Should parse the timezone option correctly");
}

@Test
public void test15046_ConflictOption() throws Exception {
    setupTest15046();
    options.addOption("c", "conflict", true, "conflict option");
    CommandLine line = parser.parse(options, cliArgs);
    assertEquals("c", line.getOptionValue('z'), "Should retain the timezone option when conflict option is defined");
    assertFalse(line.hasOption("c"), "Should not recognize the conflict option when it is not present in CLI args");
}
---
2025-07-07 10:50:05,033 - ERROR - refactor -   ✗ An unexpected error occurred during refactoring: 'PromptManager' object has no attribute '_get_test_smell_types'
Traceback (most recent call last):
  File "/Users/chenhaowei/Documents/github/AAA-Issue-Refactor/src/refactor.py", line 818, in refactor_test_case
    validation_prompt = self.prompt_manager.format_validation_user_prompt(context, sanitized_code, all_imports, test_case.issue_type)
  File "/Users/chenhaowei/Documents/github/AAA-Issue-Refactor/src/refactor.py", line 299, in format_validation_user_prompt
    return self._format_testsmell_validation_prompt(context, refactored_code, all_imports, original_issue)
  File "/Users/chenhaowei/Documents/github/AAA-Issue-Refactor/src/refactor.py", line 338, in _format_testsmell_validation_prompt
    test_smell_types = self._get_test_smell_types(context.test_class_name, context.test_case_name)
AttributeError: 'PromptManager' object has no attribute '_get_test_smell_types'
2025-07-07 10:50:05,038 - DEBUG - usage_tracker - Usage recorded: org.apache.commons.cli.bug.BugsTest.test15046 - $0.0157, 39.66s, 0 loops
2025-07-07 10:50:05,038 - ERROR - cli -   ✗ Refactoring failed: 'PromptManager' object has no attribute '_get_test_smell_types'
2025-07-07 10:50:05,097 - INFO - cli - 
✓ Refactoring results for 'testsmell' strategy saved to /Users/chenhaowei/Documents/github/AAA-Issue-Refactor/test_output_testsmell/commons-cli_refactored_result.csv
2025-07-07 10:50:05,104 - INFO - usage_tracker - Usage statistics saved to /Users/chenhaowei/Documents/github/AAA-Issue-Refactor/test_output_testsmell/commons-cli-usage.csv
2025-07-07 10:50:05,104 - INFO - usage_tracker - Summary: 1 cases, $0.0157 total cost, 39.66s total time, 0 total loops, 0/1 successful
2025-07-07 10:50:05,104 - INFO - cli - ✓ Usage statistics saved to /Users/chenhaowei/Documents/github/AAA-Issue-Refactor/test_output_testsmell/commons-cli-usage.csv
2025-07-07 10:50:05,104 - INFO - cli - ✓ Summary: 0/1 successful, $0.0157 total cost, 39.66s total time
2025-07-07 10:50:05,104 - INFO - cli - 
✓ Pipeline completed successfully.
